 \section{Implementation} \label{sec:impl}

\subsection{KVM network I/O Architecture}\label{sec:architecture}
Fig 1 shows the KVM networking I/O architecture. As depicted in the picture,
when a packet arrives at physical NIC, interrupts generated by NIC are handled 
by the physical device driver. The device driver forwards the packet to software 
bridge. The bridge, then pushes the packet to the tap device of the corresponding 
VM. The tap device is a virtual network device that sends a signal to KVM module. 
KVM module in turn, generates a virtual interrupt to the user space Qemu of the 
target VM. Qemu then copies the packet from tap device and generates the interrupt 
for the guest OS emulating the virtual NIC. Again, the physical device driver in 
the guest OS handles the packet transfer to the VMâ€™s address space.
The replication logic is entirely implemented in qemu-kvm.
We maintain a packet queue to capture outgoing packets.
