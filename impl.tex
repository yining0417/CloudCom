 \section{Implementation} \label{sec:impl}

\subsection{KVM And Its Network I/O Architecture}\label{sec:architecture}
We chose the Linux Kernel Virtual Machine (KVM) as the platform of this study.
Fig 1 shows the typical KVM architecture, with reference to a network related 
application. As depicted in the picture, when a packet arrives at physical NIC, 
interrupts generated by NIC are handled by the physical device driver. The device 
driver forwards the packet to software bridge. The bridge, then pushes the packet 
to the tap device of the corresponding VM. The tap device is a virtual network 
device that sends a signal to KVM module. KVM module in turn, generates a virtual 
interrupt to the user space Qemu of the target VM. Qemu then copies the packet from 
tap device and generates the interrupt for the guest OS emulating the virtual NIC. 
Again, the physical device driver in the guest OS handles the packet transfer to 
the VMâ€™s address space. A major advantage of the KVM architecture is the full 
availability of user-space tools in the QEMU process, such as threading, libraries 
and so on.
\subsection{Replication Logic}\label{sec:Replication}
The replication logic is entirely implemented in qemu-kvm.
We maintain a packet queue to capture outgoing packets.
