\section{Introduction} \label{sec:intro}

% P1: virtualization is good
Server virtualization has emerged as a powerful technique for consolidating servers in 
data centers. The reduction of the number of physical hosts also contributes to cutting 
back the power consumptions in the data centers.

% Symantec proposes a solution, based on VMware products, where the applications are \emph{monitored},
% however this commercial solution applies for a specific list of supported applications, 
% and does not support HA in a generic way

At the same time, the dependability issues such as service availability become a major concern 
in consolidated server systems using virtualization. There has been a tremendous progress in 
achieving high availability in virtualized environments, but existing approaches still fail to 
meet the high availability requirements of applications running in the VM because they are oriented 
toward protecting the VM. Protecting the VM alone does not guarantee uptime for applications and
services. Detecting and remediating VM failure falls short of what is truly vital, detecting and 
remediating application and service failures.

State Machine Replication (\smr) is an attractive approach to achieving high availability at the 
application level. \smr runs replicas of the program and uses a distributed consensus protocol 
(typically \paxos) to ensure the same sequence of input requests for replicas, as long as a 
quorum (typically a majority) of the replicas agrees on the input request sequence.

However, \paxos is slow because each decision takes at least three message delays between when 
a replica proposes a command and when some replica learns which command has been chosen.

Fortunately, Remote Direct Memory Access (RDMA)-capable networks have dropped in price and made 
substantial inroads into datacenters. RDMA operations allow a machine to read (or write) from a 
pre-registered memory region of another machine without involving the CPU on the remote side. 
Compared to traditional message passing, RDMA achieves the smallest round-trip latency 
(~$\sim$3 \us), highest throughput, and lowest (zero) CPU overhead~\cite{pilaf:usenix14}.

A naive approach for realizing highly available services is to integrate the \paxos algorithm 
into every application. But \paxos is notoriously difficult to understand~\cite{raft:usenix14} 
and implement~\cite{paxos:practical}.

In this paper we present an efficient HA solution for the applications running in the virtual machines. 
Our solution keeps replicas in sync by leveraging the \smr system \smrsystem in the network layer. Each incoming 
network packet is considered an input request, and the RDMA-based \paxos protocol provided by \smrsystem is invoked 
to ensure that a quorum of the replicas sees the same exact sequence of the incoming network packets. To 
deal with nondeterminism, we maintain a packet queue that captures outgoing packets and run the output 
checking protocol offered by \smrsystem periodically.

The remainder of the paper is organized as follows. In \S\ref{sec:background} we present the background 
of our work. We conclude in \S\ref{sec:conclusion}.
